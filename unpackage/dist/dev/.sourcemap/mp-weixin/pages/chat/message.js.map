{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/Administrator/Desktop/ysby/ysby/pages/chat/message.vue?95bd","webpack:///C:/Users/Administrator/Desktop/ysby/ysby/pages/chat/message.vue?424d","webpack:///C:/Users/Administrator/Desktop/ysby/ysby/pages/chat/message.vue?2c26","webpack:///C:/Users/Administrator/Desktop/ysby/ysby/pages/chat/message.vue?603f","uni-app:///pages/chat/message.vue","webpack:///C:/Users/Administrator/Desktop/ysby/ysby/pages/chat/message.vue?037a"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;wEAAA,qBACA,sBACA,2C,mDACAA,EAAWC,a;;;;2DCHX,8QACIC,EADJ,kKASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,yBACZ,aAAAF,E;;;;2GCvBf,0lC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G;;;;2DCRvB,6tBAAsqB,eAAG,G;;;;61BC+DzqB,sCACA,oC,EAGA,CACA,YACA,kBAEA,KAJA,WAKA,OACA,OACA,SACA,SACA,cACA,gBACA,aACA,YACA,gBACA,kBACA,aACA,oBACA,OACA,cAEA,SACA,cAEA,UACA,WACA,CACA,aACA,OACA,mCAEA,CACA,UACA,OACA,sCAKA,OAtCA,WAuCA,WACA,+BACA,0BACA,eACA,oBAEA,4BAqBA,uCACA,sBACA,sGASA,2CACA,iBAMA,WACA,qCAEA,qCACA,KACA,eACA,QACA,kBAEA,qBACA,CACA,2BACA,wBACA,MAGA,EAMA,kBALA,QACA,kBAEA,uBAqCA,OA7IA,WAkJA,sGACA,0DACA,qEACA,kHAEA,SACA,WADA,WACA,WACA,mBACA,qBACA,cACA,uBACA,aACA,MAGA,SAVA,SAUA,GACA,qBACA,qBACA,KACA,0BACA,kCACA,aAIA,YAGA,OAvBA,WAwBA,mBACA,qBACA,cACA,cACA,4BACA,uGAEA,WA/BA,WAgCA,mBACA,oBAGA,QApCA,SAoCA,GACA,qBAEA,kBADA,GAMA,UA5CA,WA6CA,WACA,GACA,QADA,SACA,GAEA,IADA,SACA,mBACA,2BACA,aAGA,cACA,aACA,SAGA,eAEA,wBACA,sBACA,oGAEA,MAnBA,SAmBA,GACA,iBAGA,4BAEA,WAvEA,WAwEA,WACA,gCACA,oBACA,cACA,gBACA,SAEA,iBAEA,kBACA,mBAKA,YAvFA,WA4FA,IAJA,SACA,6BACA,iCACA,oCACA,oBACA,wCACA,gDACA,cAEA,aACA,oBACA,uBACA,mBACA,qBAEA,sCACA,kCACA,wBACA,+EACA,+EACA,6BACA,WAGA,4BACA,0CACA,kDACA,cACA,aACA,oBACA,uBACA,mBACA,qBAEA,sCACA,kCACA,wBACA,+EACA,+EACA,sBACA,WA0BA,OAHA,sBACA,sCAEA,GAEA,YA5JA,SA4JA,iKACA,GADA,2EAEA,gBAFA,gCAGA,2CAEA,gBADA,GAGA,MAPA,0CACA,IADA,YACA,YADA,yCACA,GADA,eACA,IADA,sBAcA,6BACA,sBAfA,8CAiBA,YA7KA,SA6KA,cAEA,GACA,aACA,iBACA,QAEA,qCACA,kCACA,kCACA,uBACA,mBACA,iBAKA,cA9LA,SA8LA,GACA,QAGA,6DACA,2BAEA,6BAKA,oBA1MA,SA0MA,GAEA,OACA,kBACA,iBAEA,mCACA,cACA,yEAKA,mBAvNA,SAuNA,GACA,qCACA,GACA,SACA,iBACA,mBAEA,cACA,oEAIA,aAnOA,SAmOA,KACA,gBACA,OACA,iBACA,MACA,QACA,QAIA,SA7OA,SA6OA,GAEA,IACA,EADA,IAGA,EADA,gDACA,CACA,gBAGA,CACA,iBAIA,qCACA,oBAGA,aACA,SACA,mBACA,iBACA,oBACA,YACA,8BACA,0CACA,MACA,cAEA,mCAGA,wB;;;;2DCveA,ogCAA68B,eAAG,G","file":"pages/chat/message.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chat/message.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./message.vue?vue&type=template&id=79ff356e&\"\nvar renderjs\nimport script from \"./message.vue?vue&type=script&lang=js&\"\nexport * from \"./message.vue?vue&type=script&lang=js&\"\nimport style0 from \"./message.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/message.vue\"\nexport default component.exports","export * from \"-!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=template&id=79ff356e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<!-- <view class=\"search\" v-show=\"search_btn\">\n\t\t\t<view @tap=\"openSearch\">\n\t\t\t\t<icon type=\"search\" size=\"12\"></icon>\n\t\t\t\t<text>搜索</text>\n\t\t\t</view>\n\t\t</view> -->\n\t\t\n\t\t<!-- <view class=\"search_input\" v-if=\"search_chats\">\n\t\t\t<view>\n\t\t\t\t<icon type=\"search\" size=\"12\"></icon>\n\t\t\t\t<input placeholder=\"搜索\" \n\t\t\t\t\tplaceholder-style=\"color:#9B9B9B;line-height:21px;font-size:15px;\" \n\t\t\t\t\t:focus=\"focus\"\n\t\t\t\t\tconfirm-type=\"search\"\n\t\t\t\t\ttype='text'\n\t\t\t\t\t@confirm=\"onSearch\"\n\t\t\t\t\t@input=\"onInput\"\n\t\t\t\t\t:value=\"input_code\"\n\t\t\t\t\t></input>\n\t\t\t\t\t<icon type=\"clear\" size=\"12\" @tap.stop.prevent='clearInput' v-if=\"show_clear\"></icon>\n\t\t\n\t\t\t</view>\n\t\t\t<text @tap=\"cancel\">取消</text>\n\t\t</view> -->\n\t\t<view v-for=\"(item, index) in arr\" :key=\"index\" class=\"chat_list\">\n\t\t\t<uni-swipe-action :options=\"options\" @click=\"action_click($event, item)\">\n\t\t\t\t<view class=\"tap_mask\" @tap.stop.prevent=\"into_chatRoom(item)\">\n\t\t\t\t\t<view class=\"list_box\">\n\t\t\t\t\t\t<view class=\"list_left\" :data-username=\"item.username\">\n\t\t\t\t\t\t\t<view class=\"list_pic\">\n\t\t\t\t\t\t\t\t<image :src=\"(item.chatType == 'groupchat' || item.chatType == 'chatRoom')? '../../static/images/groupTheme.png':'../../static/images/theme@2x.png'\"></image>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"list_text\">\n\t\t\t\t\t\t\t\t<text class=\"list_user\">{{item.chatTarget || '用户'+(index+1)}}</text>\n\t\t\t\t\t\t\t\t<text class=\"list_word\" v-if=\"item.msg.data[0].data\">{{item.msg.data[0].data}}</text>\n\t\t\t\t\t\t\t\t<text class=\"list_word\" v-if=\"item.msg.type == 'img'\">[图片]</text>\n\t\t\t\t\t\t\t\t<text class=\"list_word\" v-if=\"item.msg.type == 'audio'\">[语音]</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"list_right\">\n\t\t\t\t\t\t\t<text :data-username=\"item.username\">{{item.time}}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"em-msgNum\" v-if=\"item.unReadCount > 0 || item.unReadCount == '99+'\">{{ item.unReadCount }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</uni-swipe-action>\n\t\t</view>\n\t\t\n\t\t<view v-if=\"arr.length == 0\" class=\"chat_noChat\">\n\t\t\t当前没有历史聊天\n\t\t</view>\n\n\t\t<view style=\"height: 1px;\"></view>\n\t\t\n\t\t\n\t\t<view class=\"mask\" @tap=\"close_mask\" v-if=\"show_mask\"></view>\n\t</view>\n</template>\n\n<script>\n\timport uniSwipeAction from \"@/comps/uni/uni-swipe-action/uni-swipe-action.vue\"\r\n\tlet msgStorage = require(\"@/comps/chat/msgstorage\");\n\tlet disp = require(\"../../utils/broadcast\");\n\tlet isfirstTime = true\n\n\texport default {\n\t\tcomponents: {\n\t\t\tuniSwipeAction\n\t\t},\n\t\tdata() {\n\t\t\treturn {\r\n\t\t\t\tuid:'',\r\n\t\t\t\ttoken:'',\n\t\t\t\tfocus: false,\n\t\t\t\tsearch_btn: true,\n\t\t\t\tsearch_chats: false,\n\t\t\t\tshow_mask: false,\n\t\t\t\tyourname: \"\",\n\t\t\t\tunReadSpotNum: 0,\n\t\t\t\tunReadNoticeNum: 0,\n\t\t\t\tmessageNum: 0,\n\t\t\t\tunReadTotalNotNum: 0,\n\t\t\t\tarr: [],\n\t\t\t\tshow_clear: false,\n\t\t\t\t\n\t\t\t\tgotop: false,\n\t\t\t\tinput_code: '',\n\t\t\t\t\n\t\t\t\toptions: [{\n\t\t\t\t\ttext: '置顶'\n\t\t\t\t}, {\n\t\t\t\t\ttext: '标记为已读',\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tbackgroundColor: 'rgb(254,156,1)'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\ttext: '删除',\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tbackgroundColor: 'rgb(255,58,49)'\n\t\t\t\t\t}\n\t\t\t\t}],\n\t\t\t}\n\t\t},\n\t\tonLoad() {\r\n\t\t\tlet me = this;\r\n\t\t\tvar userInfo=uni.getStorageSync('userInfo')\r\n\t\t\tif(userInfo!='' & userInfo!=null & userInfo!=undefined){\r\n\t\t\t\tthis.uid=userInfo.uid\r\n\t\t\t\tthis.token=userInfo.token\r\n\t\t\t}\r\n\t\t\tthis.arr = this.getChatList();\r\n\t\t\t\r\n\t\t\t// for(var i=0;i<this.arr.length;i++){\r\n\t\t\t// \tthis.transToName(this.arr[i].yourname,i)\r\n\t\t\t// }\r\n\t\t\t\n\t\t\t//监听加好友申请\n\t\t\t// disp.on(\"em.xmpp.subscribe\", function(){\n\t\t\t// \tme.messageNum = getApp().globalData.saveFriendList.length;\n\t\t\t// \tme.unReadTotalNotNum = getApp().globalData.saveFriendList.length + getApp().globalData.saveGroupInvitedList.length;\n\t\t\t// });\n\t\t\t\n\t\t\t//监听解散群\n\t\t\t// disp.on(\"em.xmpp.invite.deleteGroup\", function(){\n\t\t\t// \tme.listGroups();\n\t\t\t// \tme.getRoster();\n\t\t\t// \tme.arr = me.getChatList();\n\t\t\t// \tme.messageNum = getApp().globalData.saveFriendList.length;\n\t\t\t// });\n\t\t\t\n\t\t\t//监听未读消息数\n\t\t\tdisp.on(\"em.xmpp.unreadspot\", function(message){\r\n\t\t\t\tme.arr = me.getChatList();\n\t\t\t\tme.unReadSpotNum = getApp().globalData.unReadMessageNum > 99 ? '99+' : getApp().globalData.unReadMessageNum;\n\t\t\t});\n\t\t\t\n\t\t\t//监听未读加群“通知”\n\t\t\t// disp.on(\"em.xmpp.invite.joingroup\", function(){\n\t\t\t// \tme.unReadNoticeNum = getApp().globalData.saveGroupInvitedList.length;\n\t\t\t// \tme.unReadTotalNotNum = getApp().globalData.saveFriendList.length + getApp().globalData.saveGroupInvitedList.length\n\t\t\t// });\n\t\t\t\n\t\t\tdisp.on(\"em.xmpp.contacts.remove\", function(){\r\n\t\t\t\tme.getRoster();\n\t\t\t\t// me.setData({\n\t\t\t\t// \tarr: me.getChatList(),\n\t\t\t\t// \tunReadSpotNum: getApp().globalData.unReadMessageNum > 99 ? '99+' : getApp().globalData.unReadMessageNum,\n\t\t\t\t// });\n\t\t\t});\n\t\t\tvar that=this\r\n\t\t\tmsgStorage.on(\"newChatMsg\", function(renderableMsg, type, curChatMsg, sesskey){\r\n\t\t\t\t// 判断是否属于当前会话\r\n\t\t\t\tlet members=uni.getStorageSync('member') || [],\r\n\t\t\t\texistance=false\r\n\t\t\t\tif(members.length==0){\r\n\t\t\t\t\tmembers.push({\r\n\t\t\t\t\t\tname:renderableMsg.yourname\r\n\t\t\t\t\t})\r\n\t\t\t\t\tme.transToName(members)\r\n\t\t\t\t}else {\r\n\t\t\t\t\tfor(var i=0;i<members.length;i++){\r\n\t\t\t\t\t\tif(members[i].name==renderableMsg.yourname){\r\n\t\t\t\t\t\t\texistance=true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!existance){\r\n\t\t\t\t\t\tmembers.push({\r\n\t\t\t\t\t\t\tname:renderableMsg.yourname\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tme.transToName(members)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthat.transToName(members)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// let newMember=members.filter((item) => {\r\n\t\t\t\t// \tif(item.name==renderableMsg.info.from){\r\n\t\t\t\t// \t\treturn item.name==renderableMsg.info.to \r\n\t\t\t\t// \t}else if(item.name==renderableMsg.info.to){\r\n\t\t\t\t// \t\treturn item.name==renderableMsg.info.from \r\n\t\t\t\t// \t}\r\n\t\t\t\t\t\r\n\t\t\t\t// \t})\r\n\t\t\t\t// if(newMember.length<1){\r\n\t\t\t\t// \tif(renderableMsg.username==renderableMsg.info.from){\r\n\t\t\t\t// \t\tmembers.push({\r\n\t\t\t\t// \t\t\tname:renderableMsg.info.to\r\n\t\t\t\t// \t\t})\r\n\t\t\t\t// \t}else{\r\n\t\t\t\t// \t\tmembers.push({\r\n\t\t\t\t// \t\t\tname:renderableMsg.info.from\r\n\t\t\t\t// \t\t})\r\n\t\t\t\t// \t}\r\n\t\t\t\t// \tconsole.log(Array.from(new Set(members)))\r\n\t\t\t\t\t// uni.setStorageSync('member',members)\r\n\t\t\t\t// }\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t// that.arr.forEach((item) =>{\r\n\t\t\t\t// \titem.username=that.transToName(item.username)\r\n\t\t\t\t// })\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\n\t\t\t// this.getRoster();\n\t\t\t\n\t\t},\n\t\tonShow(){\n\t\t\t\r\n\t\t\t// this.arr.forEach((item) =>{\r\n\t\t\t\t\r\n\t\t\t// })\n\t\t\tthis.unReadSpotNum = getApp().globalData.unReadMessageNum > 99 ? '99+' : getApp().globalData.unReadMessageNum;\n\t\t\tthis.messageNum = getApp().globalData.saveFriendList.length;\n\t\t\tthis.unReadNoticeNum = getApp().globalData.saveGroupInvitedList.length;\n\t\t\tthis.unReadTotalNotNum = getApp().globalData.saveFriendList.length + getApp().globalData.saveGroupInvitedList.length;\n\t\t},\n\t\tmethods: {\n\t\t\topenSearch(){\n\t\t\t\tthis.search_btn = false;\n\t\t\t\tthis.search_chats = true;\n\t\t\t\tthis.gotop = true;\n\t\t\t\tsetTimeout(()=> { //加适当延迟,避免focus时软键盘闪退\n\t\t\t\t\tthis.focus = true;\n\t\t\t\t}, 300);\n\t\t\t},\n\t\t\t\n\t\t\tonSearch(val){\n\t\t\t\tlet searchValue = val.detail.value\n\t\t\t\tlet chartList = this.getChatList();\n\t\t\t\tlet searchList = [];\n\t\t\t\tchartList.forEach((item, index)=>{\n\t\t\t\t\tif(String(item.username).indexOf(searchValue) != -1){\n\t\t\t\t\t\tsearchList.push(item)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tthis.arr = searchList\n\t\t\t},\n\t\t\t\n\t\t\tcancel(){\n\t\t\t\tthis.search_btn = true;\n\t\t\t\tthis.search_chats = false;\n\t\t\t\tthis.gotop = false;\n\t\t\t\tthis.focus = false;\n\t\t\t\tthis.arr = this.getChatList();\n\t\t\t\tthis.unReadSpotNum = getApp().globalData.unReadMessageNum > 99 ? '99+' : getApp().globalData.unReadMessageNum;\n\t\t\t},\n\t\t\tclearInput(){\n\t\t\t\tthis.input_code = '';\n\t\t\t\tthis.show_clear = false;\n\t\t\t},\n\t\t\t\n\t\t\tonInput(e){\n\t\t\t\tlet inputValue = e.detail.value\n\t\t\t\tif (inputValue) {\n\t\t\t\t\tthis.show_clear = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.show_clear = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetRoster() {\n\t\t\t\tlet me = this;\n\t\t\t\tlet rosters = {\n\t\t\t\t\tsuccess(roster){\n\t\t\t\t\t\tvar member = [];\n\t\t\t\t\t\tfor(let i = 0; i < roster.length; i++){\n\t\t\t\t\t\t\tif(roster[i].subscription == \"both\"){\n\t\t\t\t\t\t\t\tmember.push(roster[i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tuni.setStorage({\n\t\t\t\t\t\t\tkey: \"member\",\n\t\t\t\t\t\t\tdata: member\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tme.listGroups()\n\t\t\t\t\t\t\n\t\t\t\t\t\tdisp.fire(\"em.main.ready\");\n\t\t\t\t\t\tme.arr = me.getChatList();\n\t\t\t\t\t\tme.unReadSpotNum = getApp().globalData.unReadMessageNum > 99 ? '99+' : getApp().globalData.unReadMessageNum\n\t\t\t\t\t},\n\t\t\t\t\terror(err){\n\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$im.conn.getRoster(rosters);\n\t\t\t},\n\t\t\tlistGroups(){\n\t\t\t\tvar me = this;\n\t\t\t\treturn this.$im.conn.listRooms({\n\t\t\t\t\tsuccess: function(rooms){\n\t\t\t\t\t\tuni.setStorage({\n\t\t\t\t\t\t\tkey: \"listGroup\",\n\t\t\t\t\t\t\tdata: rooms\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.getChatList()\n\t\t\t\t\t},\n\t\t\t\t\terror: function(err){\n\t\t\t\t\t\tconsole.log(err)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t getChatList(){\n\t\t\t\tvar array = [];\n\t\t\t\tvar member = uni.getStorageSync(\"member\");\r\n\t\t\t\tvar myName = uni.getStorageSync(\"myUsername\");\n\t\t\t\tvar listGroups = uni.getStorageSync('listGroup')|| [];\r\n\t\t\t\tfor(let i = 0; i < member.length; i++){\n\t\t\t\t\tlet newChatMsgs = uni.getStorageSync(member[i].name + myName) || [];\n\t\t\t\t\tlet historyChatMsgs = uni.getStorageSync(\"rendered_\" + member[i].name + myName) || [];\n\t\t\t\t\tlet curChatMsgs = historyChatMsgs.concat(newChatMsgs);\n\t\t\t\t\t\n\t\t\t\t\tif(curChatMsgs.length){\n\t\t\t\t\t\tlet lastChatMsg = curChatMsgs[curChatMsgs.length - 1];\n\t\t\t\t\t\tlastChatMsg.unReadCount = newChatMsgs.length;\n\t\t\t\t\t\tif(lastChatMsg.unReadCount > 99) {\n\t\t\t\t\t\t\tlastChatMsg.unReadCount = \"99+\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet dateArr = lastChatMsg.time.split(' ')[0].split('-')\n\t\t\t\t\t\tlet timeArr = lastChatMsg.time.split(' ')[1].split(':')\n\t\t\t\t\t\tlet month = dateArr[2] < 10 ? '0' + dateArr[2] : dateArr[2]\n\t\t\t\t\t\tlastChatMsg.dateTimeNum = `${dateArr[1]}${month}${timeArr[0]}${timeArr[1]}${timeArr[2]}`\n\t\t\t\t\t\tlastChatMsg.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}时${timeArr[1]}分`\r\n\t\t\t\t\t\tlastChatMsg.chatTarget=member[i].chatTarget\r\n\t\t\t\t\t\tarray.push(lastChatMsg);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(let i = 0; i < listGroups.length; i++){\n\t\t\t\t\tlet newChatMsgs = uni.getStorageSync(listGroups[i].roomId + myName) || [];\n\t\t\t\t\tlet historyChatMsgs = uni.getStorageSync(\"rendered_\" + listGroups[i].roomId + myName) || [];\n\t\t\t\t\tlet curChatMsgs = historyChatMsgs.concat(newChatMsgs);\n\t\t\t\t\tif(curChatMsgs.length){\n\t\t\t\t\t\tlet lastChatMsg = curChatMsgs[curChatMsgs.length - 1];\n\t\t\t\t\t\tlastChatMsg.unReadCount = newChatMsgs.length;\n\t\t\t\t\t\tif(lastChatMsg.unReadCount > 99) {\n\t\t\t\t\t\t\tlastChatMsg.unReadCount = \"99+\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet dateArr = lastChatMsg.time.split(' ')[0].split('-')\n\t\t\t\t\t\tlet timeArr = lastChatMsg.time.split(' ')[1].split(':')\n\t\t\t\t\t\tlet month = dateArr[2] < 10 ? '0' + dateArr[2] : dateArr[2]\n\t\t\t\t\t\tlastChatMsg.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}时${timeArr[1]}分`\n\t\t\t\t\t\tlastChatMsg.dateTimeNum = `${dateArr[1]}${month}${timeArr[0]}${timeArr[1]}${timeArr[2]}`\n\t\t\t\t\t\tlastChatMsg.groupName = listGroups[i].name\r\n\t\t\t\t\t\tarray.push(lastChatMsg);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//\t测试列表\n\t\t\t\t\n\t\t\t\t// for (let i = 0; i < 12; i++) {\n\t\t\t\t// \tlet newSESSION = {\n\t\t\t\t// \t\tinfo: {from: \"zdtest\", to: \"zdtest2\"},\n\t\t\t\t// \t\tmid: \"txtWEBIM_427ab8b10c\",\n\t\t\t\t// \t\tunReadCount: 6,\n\t\t\t\t// \t\tmsg: {type: \"txt\", data: [{data: \"丢晚高丢完\", type: \"txt\"}]},\n\t\t\t\t// \t\tstyle: \"self\",\n\t\t\t\t// \t\ttime: \"2019-2-18 16:59:25\",\n\t\t\t\t// \t\tusername: \"zdtest\" + i,\n\t\t\t\t// \t\tyourname: \"zdtest\"\n\t\t\t\t// \t}\n\t\t\t\t// \tlet dateArr = newSESSION.time.split(' ')[0].split('-')\n\t\t\t\t// \tlet timeArr = newSESSION.time.split(' ')[1].split(':')\n\t\t\t\t// \tnewSESSION.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}时${timeArr[1]}分`\n\t\t\t\t// \tarray.push(newSESSION)\n\t\t\t\t// }\n\t\t\t\t\n\t\t\t\tarray.sort((a, b) => {\n\t\t\t\t\treturn b.dateTimeNum - a.dateTimeNum\n\t\t\t\t})\r\n\t\t\t\treturn array;\n\t\t\t},\n\t\t async transToName(members){\r\n\t\t \tfor(let i=0;i<members.length;i++){\r\n\t\t \t\tif(!members[i].chatTarget){\r\n\t\t \t\tawait\tthis.getNameById(members[i].name).then((res) =>{\r\n\t\t \t\t\t\tif(res){\r\n\t\t \t\t\t\t\tmembers[i].chatTarget=res\r\n\t\t \t\t\t\t}else{\r\n\t\t \t\t\t\t\tmembers[i].chatTarget=''\r\n\t\t \t\t\t\t}\r\n\t\t \t\t\t})\r\n\t\t \t\t\t// members[i].chatTarget=await this.getNameById(members[i].name)\r\n\t\t \t\t\t// console.log(name)\r\n\t\t \t\t}\r\n\t\t \t}\r\n\t\t \tuni.setStorageSync('member',members)\r\n\t\t\tthis.arr = this.getChatList();\r\n\t\t },\r\n\t\t getNameById(id){\r\n\t\t \tvar that=this,merchname,\r\n\t\t \tparams={\r\n\t\t \t\tuid:this.uid,\r\n\t\t \t\ttoken:this.token,\r\n\t\t \t\thxid:id\r\n\t\t \t}\r\n\t\t \t  var url='&r=api.member.assist.hxidToMerch'\r\n\t\t \t  return new Promise((resolve,reject) =>{\r\n\t\t \t\t  this.$apiPost(url,params).then((res) =>{\r\n\t\t \t\t\t  resolve(res.data.merchname)\r\n\t\t \t\t  }).catch((err) =>{\r\n\t\t \t\t  \tthis.$msg(err)\r\n\t\t \t\t  })\r\n\t\t \t  })\r\n\t\t \t  \r\n\t\t },\n\t\t\tinto_chatRoom(item){\n\t\t\t\tlet detail = item;\n\t\t\t\t//↓↓↓↓ 谁赞成谁反对?\n\t\t\t\t//群聊的chatType居然是singlechat？脏数据？ 等sdk重写后整理一下字段\n\t\t\t\tif (detail.chatType == 'groupchat' || detail.chatType == 'chatRoom' || detail.groupName) {\n\t\t\t\t\tthis.into_groupChatRoom(detail)\n\t\t\t\t} else {\n\t\t\t\t\tthis.into_singleChatRoom(detail)\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t//\t单聊\n\t\t\tinto_singleChatRoom(detail){\r\n\t\t\t\t// var my = uni.getStorageSync(\"userInfo\");\r\n\t\t\t\tvar nameList = {\n\t\t\t\t\tmyName: detail.username,\n\t\t\t\t\tyour: detail.yourname\n\t\t\t\t};\r\n\t\t\t\tuni.$emit('reduceMsg',detail.unReadCount)\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: \"../chat/chat?username=\" + JSON.stringify(nameList)+'&title='+detail.chatTarget\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t//\t群聊 和 聊天室 （两个概念）\n\t\t\tinto_groupChatRoom(detail){\n\t\t\t\tvar my = uni.getStorageSync(\"myUsername\");\n\t\t\t\tvar nameList = {\n\t\t\t\t\tmyName: my,\n\t\t\t\t\tyour: detail.groupName,\n\t\t\t\t\tgroupId: detail.info.to\n\t\t\t\t};\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: \"../groupChatRoom/groupChatRoom?username=\" + JSON.stringify(nameList)\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\taction_click(e, item) {\n\t\t\t\tswitch (e.index){\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tthis.del_chat(item);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tdel_chat(item){\n\t\t\t\t\n\t\t\t\tlet detail = item;\n\t\t\t\tlet nameList;\n\t\t\t\tif (detail.chatType == 'groupchat' || detail.chatType == 'chatRoom') {\n\t\t\t\t\tnameList = {\n\t\t\t\t\t\tyour: detail.info.to\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tnameList = {\n\t\t\t\t\t\tyour: detail.username\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\n\t\t\t\tvar myName = uni.getStorageSync(\"myUsername\");\n\t\t\t\tvar currentPage = getCurrentPages();\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: \"\",\n\t\t\t\t\tcontent: \"删除该聊天记录?\",\n\t\t\t\t\tconfirmText: \"删除\",\n\t\t\t\t\tsuccess: function(res){\n\t\t\t\t\t\tif(res.confirm){\n\t\t\t\t\t\t\tuni.setStorageSync(nameList.your + myName, \"\");\n\t\t\t\t\t\t\tuni.setStorageSync(\"rendered_\" + nameList.your + myName, \"\");\n\t\t\t\t\t\t\tif(currentPage[0]){\n\t\t\t\t\t\t\t\tcurrentPage[0].onShow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdisp.fire(\"em.chat.session.remove\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfail: function(err){\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t}\n\t}\n</script>\n\n<style>\n\t@import '../../common/css/pages/chat.css';\n</style>\n","import mod from \"-!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../hbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}