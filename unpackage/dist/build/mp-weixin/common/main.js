(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"20db":function(e,o,t){"use strict";t.r(o);var n=t("969f"),a=t.n(n);for(var r in n)"default"!==r&&function(e){t.d(o,e,(function(){return n[e]}))}(r);o["default"]=a.a},"3cd5":function(e,o,t){"use strict";(function(e){t("fabc");var o=s(t("66fd")),n=s(t("47b8")),a=t("d420"),r=s(t("ae07"));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?c(Object(t),!0).forEach((function(o){u(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function u(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}var l=t("d4bf")["default"],p={closed:!1,curOpenOpt:{},open:function(e){this.curOpenOpt=e,l.conn.open(e),this.closed=!1},reopen:function(){this.closed&&(l.conn.open(this.curOpenOpt),this.closed=!1)}};o.default.prototype.$im=l,o.default.prototype.$conn=p,o.default.config.productionTip=!1,o.default.prototype.$getHeight=a.getHeight,o.default.prototype.$loading=a.loading,o.default.prototype.$msg=a.msg,o.default.prototype.$upload=a.upload,o.default.prototype.$operateInterceptor=a.operateInterceptor,o.default.prototype.$apiPost=r.default.apiPost,o.default.prototype.$apiGet=r.default.apiGet,o.default.prototype.$imgBaseUrl="http://192.168.1.157/yishuban2/attachment/",n.default.mpType="app";var d=new o.default(i({},n.default));e(d).$mount()}).call(this,t("543d")["createApp"])},"47b8":function(e,o,t){"use strict";t.r(o);var n=t("20db");for(var a in n)"default"!==a&&function(e){t.d(o,e,(function(){return n[e]}))}(a);t("613e");var r,s,c,i,u=t("f0c5"),l=Object(u["a"])(n["default"],r,s,!1,null,null,null,!1,c,i);o["default"]=l.exports},"613e":function(e,o,t){"use strict";var n=t("9303"),a=t.n(n);a.a},9303:function(e,o,t){},"969f":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,t("5a0e");var n=t("7657"),a=t("57fd"),r=t("ac99"),s=!1,c=!1,i={globalData:{unReadMessageNum:0,userInfo:null,saveFriendList:[],saveGroupInvitedList:[],groupList:[],isIPX:!1},onLaunch:function(){},onShow:function(){var o=e.getStorageSync("userInfo");""!=o&null!=o&void 0!=o&&this.HxInit()},onHide:function(){this.$conn.closed=!0,this.$im.conn.close()},methods:{onLoginSuccess:function(){e.hideToast(),e.switchTab({url:"../chat/chat"})},ack:function(e){var o=e.id,t=new this.$im.message("read",this.$im.conn.getUniqueId());t.set({id:o,to:e.from}),this.$im.conn.send(t.body)},onMessageError:function(o){return"error"!==o.type||(e.showToast({title:o.errorText}),!1)},getCurrentRoute:function(){var e=getCurrentPages(),o=e[e.length-1];return o.route},calcUnReadSpot:function(o){var t=e.getStorageSync("myUsername"),n=e.getStorageSync("member")||[],a=e.getStorageSync("listGroup")||[],s=n.concat(a),c=s.reduce((function(o,n,a){var r;return r=n.roomId?e.getStorageSync(n.roomId+t.toLowerCase())||[]:e.getStorageSync(n.name.toLowerCase()+t.toLowerCase())||[],o+r.length}),0);this.$options.globalData.unReadMessageNum=c,r.fire("em.xmpp.unreadspot",o)},HxInit:function(){var o=this,t=this,i=e.getStorageSync("logs")||[];i.unshift(Date.now()),e.setStorageSync("logs",i),r.on("em.main.ready",(function(){t.calcUnReadSpot()})),r.on("em.chatroom.leave",(function(){t.calcUnReadSpot()})),r.on("em.chat.session.remove",(function(){t.calcUnReadSpot()})),r.on("em.chat.audio.fileLoaded",(function(){t.calcUnReadSpot()})),r.on("em.main.deleteFriend",(function(){t.calcUnReadSpot()})),r.on("em.chat.audio.fileLoaded",(function(){t.calcUnReadSpot()}));var u=e.getStorageSync("userInfo");""!=u&null!=u&void 0!=u&&(this.$conn.open({apiUrl:this.$im.config.apiURL,user:u.hx_openid,pwd:u.hx_pwd,grant_type:"password",appKey:this.$im.config.appkey}),e.setStorageSync("myUsername",u.hx_openid)),this.$im.conn.listen({onOpened:function(t){o.$im.conn.setPresence(),console.log("登录成功"),t.accessToken&&e.setStorageSync("myToken",t.accessToken),c&&(e.hideToast(),c=!1)},onReconnect:function(){console.log("reconnect")},onSocketConnected:function(){console.log("socketConnected")},onClosed:function(){console.log("close"),o.$conn.closed=!0,o.$im.conn.close()},onInviteMessage:function(e){o.$options.globalData.saveGroupInvitedList.push(e),r.fire("em.xmpp.invite.joingroup",e)},onPresence:function(t){switch(console.log("onPresence",t),t.type){case"unsubscribe":break;case"subscribe":if("[resp:true]"===t.status)return;for(var n=0;n<o.$options.globalData.saveFriendList.length;n++)if(o.$options.globalData.saveFriendList[n].from===t.from)return o.$options.globalData.saveFriendList[n]=t,void r.fire("em.xmpp.subscribe");o.$options.globalData.saveFriendList.push(t),r.fire("em.xmpp.subscribe");break;case"subscribed":e.showToast({title:"添加成功",duration:1e3}),r.fire("em.xmpp.subscribed");break;case"unsubscribed":e.showToast({title:"已拒绝",duration:1e3});break;case"memberJoinPublicGroupSuccess":o.$helper.toast("none","已进群",1e3);break;case"unavailable":r.fire("em.xmpp.contacts.remove"),r.fire("em.xmpp.group.leaveGroup",t);break;case"deleteGroupChat":r.fire("em.xmpp.invite.deleteGroup",t);break;case"leaveGroup":r.fire("em.xmpp.group.leaveGroup",t);break;case"removedFromGroup":r.fire("em.xmpp.group.leaveGroup",t);break;default:break}},onRoster:function(e){},onVideoMessage:function(e){console.log("onVideoMessage: ",e),e&&n.saveReceiveMsg(e,a.VIDEO),o.calcUnReadSpot(e),o.ack(e)},onAudioMessage:function(e){console.log("onAudioMessage",e),e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.AUDIO),o.calcUnReadSpot(e),o.ack(e))},onCmdMessage:function(e){console.log("onCmdMessage",e),e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.CMD),o.calcUnReadSpot(e),o.ack(e))},onTextMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.TEXT),o.calcUnReadSpot(e),o.ack(e))},onCustomizeMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.CUSTOMIZE),o.calcUnReadSpot(e),o.ack(e))},onEmojiMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.EMOJI),o.calcUnReadSpot(e),o.ack(e))},onPictureMessage:function(e){console.log("onPictureMessage",e),e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.IMAGE),o.calcUnReadSpot(e),o.ack(e))},onFileMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,a.FILE),o.calcUnReadSpot(e),o.ack(e))},onError:function(t){if(e.showToast({title:t.type,icon:"success",duration:2e3}),t.type==o.$im.statusCode.WEBIM_CONNCTION_DISCONNECTED&&!s){if(o.$im.conn.autoReconnectNumTotal<o.$im.conn.autoReconnectNumMax)return;return e.showToast({title:"服务端关闭连接"}),void(s=!0)}t.type==o.$im.statusCode.WEBIM_CONNCTION_SERVER_ERROR&&e.showToast({title:"出现异地登录，连接断开"}),t.type==o.$im.statusCode.WEBIM_CONNCTION_OPEN_ERROR&&r.fire("em.xmpp.error.passwordErr"),t.type==o.$im.statusCode.WEBIM_CONNCTION_AUTH_ERROR&&r.fire("em.xmpp.error.tokenErr"),"socket_error"==t.type&&(e.showToast({title:t.type,duration:2e3}),r.fire("em.xmpp.error.sendMsgErr",t),o.$conn.closed=!0,o.$im.conn.close())}}),!this.$im.conn.isOpened()&&e.getStorageSync("myToken")&&e.getStorageSync("myUsername")&&(c=!0)},updateTest:function(){var o=this;plus.runtime.getProperty(plus.runtime.appid,(function(t){var n="&r=api.update.hot",a={version:t.version,name:t.name},r=o;o.$apiPost(n,a).then((function(o){"1"==o.update&&o.wgtUrl&&e.showModal({title:"提示",content:"可以更新",confirmText:"更新",cancelText:"不更新",success:function(n){if(n.confirm){r.$loading("下载中");var a=plus.downloader.createDownload(o.wgtUrl,{filename:"_doc/update/"+t.name+"/"+(new Date).getTime()+"/"},(function(o,t){e.hideLoading();var n=o.filename;r.$loading("安装中..."),plus.runtime.install(n,{force:!1},(function(o){e.hideLoading(),plus.runtime.restart()}),(function(o){e.hideLoading(),r.$msg("安装失败")}))}));a.start()}else n.cancel&&console.log("用户点击取消")}})})).catch((function(e){o.$msg(e),console.log(e)}))}))}}};o.default=i}).call(this,t("543d")["default"])}},[["3cd5","common/runtime","common/vendor"]]]);