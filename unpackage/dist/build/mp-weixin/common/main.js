(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"20db":function(e,o,t){"use strict";t.r(o);var n=t("969f"),r=t.n(n);for(var a in n)"default"!==a&&function(e){t.d(o,e,(function(){return n[e]}))}(a);o["default"]=r.a},"3cd5":function(e,o,t){"use strict";(function(e){t("fabc");var o=s(t("66fd")),n=s(t("47b8")),r=t("d420"),a=s(t("ae07"));function s(e){return e&&e.__esModule?e:{default:e}}function i(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?i(Object(t),!0).forEach((function(o){u(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function u(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}var l=t("d4bf")["default"],p={closed:!1,curOpenOpt:{},open:function(e){this.curOpenOpt=e,l.conn.open(e),this.closed=!1},reopen:function(){this.closed&&(l.conn.open(this.curOpenOpt),this.closed=!1)}};o.default.prototype.$im=l,o.default.prototype.$conn=p,o.default.config.productionTip=!1,o.default.prototype.$getHeight=r.getHeight,o.default.prototype.$loading=r.loading,o.default.prototype.$msg=r.msg,o.default.prototype.$upload=r.upload,o.default.prototype.$operateInterceptor=r.operateInterceptor,o.default.prototype.$apiPost=a.default.apiPost,o.default.prototype.$apiGet=a.default.apiGet,o.default.prototype.$imgBaseUrl="http://192.168.1.157/yishuban2/attachment/",n.default.mpType="app";var d=new o.default(c({},n.default));e(d).$mount()}).call(this,t("543d")["createApp"])},"47b8":function(e,o,t){"use strict";t.r(o);var n=t("20db");for(var r in n)"default"!==r&&function(e){t.d(o,e,(function(){return n[e]}))}(r);t("613e");var a,s,i,c,u=t("f0c5"),l=Object(u["a"])(n["default"],a,s,!1,null,null,null,!1,i,c);o["default"]=l.exports},"613e":function(e,o,t){"use strict";var n=t("9303"),r=t.n(n);r.a},9303:function(e,o,t){},"969f":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0,t("5a0e");var n=t("7657"),r=t("57fd"),a=t("ac99"),s=!1,i=!1,c={globalData:{unReadMessageNum:0,userInfo:null,saveFriendList:[],saveGroupInvitedList:[],groupList:[],isIPX:!1},onLaunch:function(){var o=this,t=this,c=e.getStorageSync("logs")||[];c.unshift(Date.now()),e.setStorageSync("logs",c),a.on("em.main.ready",(function(){t.calcUnReadSpot()})),a.on("em.chatroom.leave",(function(){console.log("em.chatroom.leave"),t.calcUnReadSpot()})),a.on("em.chat.session.remove",(function(){t.calcUnReadSpot()})),a.on("em.chat.audio.fileLoaded",(function(){t.calcUnReadSpot()})),a.on("em.main.deleteFriend",(function(){t.calcUnReadSpot()})),a.on("em.chat.audio.fileLoaded",(function(){t.calcUnReadSpot()}));var u=e.getStorageSync("userInfo");""!=u&null!=u&void 0!=u&&(this.$conn.open({apiUrl:this.$im.config.apiURL,user:u.hx_openid,pwd:u.hx_pwd,grant_type:"password",appKey:this.$im.config.appkey}),e.setStorageSync("myUsername",u.hx_openid)),this.$im.conn.listen({onOpened:function(t){o.$im.conn.setPresence(),console.log("登录成功"),t.accessToken&&e.setStorageSync("myToken",t.accessToken),i&&(e.hideToast(),o.$helper.toast("success","登陆成功",2e3),i=!1),"pages/login/login"!=o.getCurrentRoute()&&"pages/login_token/login_token"!=getCurrentRoute()||o.onLoginSuccess()},onReconnect:function(){o.$helper.toast("loading","重连中...",2e3)},onSocketConnected:function(){o.$helper.toast("success","登陆成功",2e3)},onClosed:function(){o.$helper.toast("none","网络已断开",2e3),e.redirectTo({url:"../login/login"}),o.$conn.closed=!0,o.$im.conn.close()},onInviteMessage:function(e){o.$options.globalData.saveGroupInvitedList.push(e),a.fire("em.xmpp.invite.joingroup",e)},onPresence:function(t){switch(console.log("onPresence",t),t.type){case"unsubscribe":break;case"subscribe":if("[resp:true]"===t.status)return;for(var n=0;n<o.$options.globalData.saveFriendList.length;n++)if(o.$options.globalData.saveFriendList[n].from===t.from)return o.$options.globalData.saveFriendList[n]=t,void a.fire("em.xmpp.subscribe");o.$options.globalData.saveFriendList.push(t),console.log(JSON.stringify(o.$options.globalData.saveFriendList)),a.fire("em.xmpp.subscribe");break;case"subscribed":e.showToast({title:"添加成功",duration:1e3}),a.fire("em.xmpp.subscribed");break;case"unsubscribed":e.showToast({title:"已拒绝",duration:1e3});break;case"memberJoinPublicGroupSuccess":o.$helper.toast("none","已进群",1e3);break;case"unavailable":a.fire("em.xmpp.contacts.remove"),a.fire("em.xmpp.group.leaveGroup",t);break;case"deleteGroupChat":a.fire("em.xmpp.invite.deleteGroup",t);break;case"leaveGroup":a.fire("em.xmpp.group.leaveGroup",t);break;case"removedFromGroup":a.fire("em.xmpp.group.leaveGroup",t);break;default:break}},onRoster:function(e){},onVideoMessage:function(e){console.log("onVideoMessage: ",e),e&&n.saveReceiveMsg(e,r.VIDEO),o.calcUnReadSpot(e),o.ack(e)},onAudioMessage:function(e){console.log("onAudioMessage",e),e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,r.AUDIO),o.calcUnReadSpot(e),o.ack(e))},onCmdMessage:function(e){console.log("onCmdMessage",e),e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,r.CMD),o.calcUnReadSpot(e),o.ack(e))},onTextMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,r.TEXT),o.calcUnReadSpot(e),o.ack(e))},onEmojiMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,r.EMOJI),o.calcUnReadSpot(e),o.ack(e))},onPictureMessage:function(e){console.log("onPictureMessage",e),e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,r.IMAGE),o.calcUnReadSpot(e),o.ack(e))},onFileMessage:function(e){e&&(o.onMessageError(e)&&n.saveReceiveMsg(e,r.FILE),o.calcUnReadSpot(e),o.ack(e))},onError:function(t){if(console.log(t),t.type==o.$im.statusCode.WEBIM_CONNCTION_DISCONNECTED&&!s){if(o.$im.conn.autoReconnectNumTotal<o.$im.conn.autoReconnectNumMax)return;return e.showToast({title:"server-side close the websocket connection",duration:1e3}),e.redirectTo({url:"../login/login"}),void(s=!0)}t.type==o.$im.statusCode.WEBIM_CONNCTION_SERVER_ERROR&&(e.showToast({title:"offline by multi login",duration:1e3}),e.redirectTo({url:"../login/login"})),t.type==o.$im.statusCode.WEBIM_CONNCTION_OPEN_ERROR&&a.fire("em.xmpp.error.passwordErr"),t.type==o.$im.statusCode.WEBIM_CONNCTION_AUTH_ERROR&&a.fire("em.xmpp.error.tokenErr"),"socket_error"==t.type&&(console.log("socket_errorsocket_error",t),e.showToast({title:"网络已断开",icon:"none",duration:2e3}),a.fire("em.xmpp.error.sendMsgErr",t))}})},onShow:function(){console.log("App Show")},onHide:function(){console.log("App Hide")},methods:{onLoginSuccess:function(){e.hideToast(),e.switchTab({url:"../chat/chat"})},ack:function(e){var o=e.id,t=new this.$im.message("read",this.$im.conn.getUniqueId());t.set({id:o,to:e.from}),this.$im.conn.send(t.body)},onMessageError:function(o){return"error"!==o.type||(e.showToast({title:o.errorText}),!1)},getCurrentRoute:function(){var e=getCurrentPages(),o=e[e.length-1];return o.route},calcUnReadSpot:function(o){var t=e.getStorageSync("myUsername"),n=e.getStorageSync("member")||[],r=e.getStorageSync("listGroup")||[],s=n.concat(r),i=s.reduce((function(o,n,r){var a;return a=n.roomId?e.getStorageSync(n.roomId+t.toLowerCase())||[]:e.getStorageSync(n.name.toLowerCase()+t.toLowerCase())||[],o+a.length}),0);this.$options.globalData.unReadMessageNum=i,a.fire("em.xmpp.unreadspot",o)}}};o.default=c}).call(this,t("543d")["default"])}},[["3cd5","common/runtime","common/vendor"]]]);