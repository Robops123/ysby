(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/recharge"],{"187b":function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(e("4795"));function i(n){return n&&n.__esModule?n:{default:n}}function a(n,t,e,o,i,a,r){try{var c=n[a](r),s=c.value}catch(u){return void e(u)}c.done?t(s):Promise.resolve(s).then(o,i)}function r(n){return function(){var t=this,e=arguments;return new Promise((function(o,i){var r=n.apply(t,e);function c(n){a(r,o,i,c,s,"next",n)}function s(n){a(r,o,i,c,s,"throw",n)}c(void 0)}))}}var c={data:function(){return{uid:"",token:"",type:"",platform:"",money:"",orderno:"",loading:!1,price:0,providerList:[]}},onNavigationBarButtonTap:function(){this.toList()},onLoad:function(t){this.price=t.data,this.platform=n.getSystemInfoSync().platform;var e=n.getStorageSync("userInfo");""!=e&null!=e&void 0!=e&&(this.uid=e.uid,this.token=e.token),this.getProviders()},methods:{radioChange:function(n){this.type=n.detail.value},toList:function(){n.navigateTo({url:"/pages/mine/rechargeList"})},pay:function(){var t=this;if(this.type){var e,o=this.providerList.filter((function(n){return n.id==t.type}));e=o.length>0?o[0].name:"微信",n.showModal({title:"提示",content:"确认使用"+e+"支付吗",success:function(n){n.confirm&&t.weixinPay()}})}else this.$msg("请选择充值方式")},getProviders:function(){},weixinPay:function(){var t=this;if(this.money){this.loading=!0;var e=this;n.login({provider:"weixin",success:function(o){n.request({url:"https://www.wxzdhy.cn/app/index.php?i=2&c=entry&m=zhonghong_zhihui&do=mobile&r=api.order.pay&code=".concat(o.code,"&money=").concat(e.money,"&uid=").concat(e.uid,"&token=").concat(e.token,"&type=1"),method:"GET",success:function(o){if(console.log("pay request success",o),200===o.statusCode)if(200===o.data.state){console.log("得到接口prepay_id",o.data);var i=o.data;n.requestPayment({provider:"wxpay",timeStamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:"MD5",paySign:i.paySign,success:function(n){e.$msg("充值成功"),e.getUserInfo()},fail:function(t){n.showModal({content:"支付失败",showCancel:!1})},complete:function(){t.loading=!1}})}else n.showModal({content:o.data.desc,showCancel:!1});else n.showModal({content:"支付失败，请重试！",showCancel:!1})},fail:function(e){console.log("fail",e),t.loading=!1,n.showModal({content:"支付失败",showCancel:!1})}})},fail:function(e){console.log("fail",e),t.loading=!1,n.showModal({content:"支付失败",showCancel:!1})}})}else this.$msg("请输入充值金额")},requestPayment:function(t){var e=this;return r(o.default.mark((function i(){var a,r;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e.money){o.next=3;break}return e.$msg("请输入充值金额"),o.abrupt("return");case 3:return a=e,e.$loading(),e.loading=!0,o.next=8,e.getOrderInfo(t);case 8:r=o.sent,console.log(r),n.requestPayment({provider:t,orderInfo:r.data,success:function(n){a.$msg("充值成功"),a.getUserInfo()},fail:function(t){n.showModal({content:"支付失败",showCancel:!1})},complete:function(){e.loading=!1}});case 11:case"end":return o.stop()}}),i)})))()},getOrderInfo:function(t){var e="http://www.wxzdhy.cn/app/index.php?i=2&c=entry&m=zhonghong_zhihui&do=mobile&r=api.member.recharge.pay",o={uid:this.uid,token:this.token,type:t,money:this.money};return new Promise((function(t){n.request({url:e,data:o,success:function(e){n.hideLoading(),t(e)},fail:function(e){n.hideLoading(),t(e)}})}))},restPay:function(){this.$loading();var t=this,e={uid:this.uid,token:this.token,orderno:this.orderno},o="&r=api.member.order.pay";this.$apiPost(o,e).then((function(e){n.hideLoading(),t.$msg("支付成功"),n.$emit("updateOrder"),setTimeout((function(){n.redirectTo({url:"./payResult?contact="+t.contact+"&money="+t.money+"&orderno="+t.orderno})}),1e3)}))},getUserInfo:function(){var n=this,t="&r=api.member.my&uid="+this.uid+"&token="+this.token;this.$apiPost(t).then((function(t){n.price=t.data.balance}))}}};t.default=c}).call(this,e("543d")["default"])},"5a4e":function(n,t,e){"use strict";e.r(t);var o=e("187b"),i=e.n(o);for(var a in o)"default"!==a&&function(n){e.d(t,n,(function(){return o[n]}))}(a);t["default"]=i.a},"76fc7":function(n,t,e){},"812e":function(n,t,e){"use strict";(function(n){e("fabc");o(e("66fd"));var t=o(e("cfba"));function o(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("543d")["createPage"])},"8ee3":function(n,t,e){"use strict";var o,i=function(){var n=this,t=n.$createElement;n._self._c},a=[];e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return a})),e.d(t,"a",(function(){return o}))},cfba:function(n,t,e){"use strict";e.r(t);var o=e("8ee3"),i=e("5a4e");for(var a in i)"default"!==a&&function(n){e.d(t,n,(function(){return i[n]}))}(a);e("d67b");var r,c=e("f0c5"),s=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);t["default"]=s.exports},d67b:function(n,t,e){"use strict";var o=e("76fc7"),i=e.n(o);i.a}},[["812e","common/runtime","common/vendor"]]]);