(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/cashier"],{"4baf":function(n,e,t){"use strict";t.r(e);var o=t("621d"),i=t("957d");for(var r in i)"default"!==r&&function(n){t.d(e,n,(function(){return i[n]}))}(r);t("bfbe");var a,c=t("f0c5"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);e["default"]=u.exports},"4e6c":function(n,e,t){"use strict";(function(n){t("fabc");o(t("66fd"));var e=o(t("4baf"));function o(n){return n&&n.__esModule?n:{default:n}}n(e.default)}).call(this,t("543d")["createPage"])},"621d":function(n,e,t){"use strict";var o,i=function(){var n=this,e=n.$createElement;n._self._c},r=[];t.d(e,"b",(function(){return i})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return o}))},"957d":function(n,e,t){"use strict";t.r(e);var o=t("fe1e"),i=t.n(o);for(var r in o)"default"!==r&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=i.a},bfbe:function(n,e,t){"use strict";var o=t("f2b3"),i=t.n(o);i.a},f2b3:function(n,e,t){},fe1e:function(n,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(t("4795"));function i(n){return n&&n.__esModule?n:{default:n}}function r(n,e,t,o,i,r,a){try{var c=n[r](a),u=c.value}catch(s){return void t(s)}c.done?e(u):Promise.resolve(u).then(o,i)}function a(n){return function(){var e=this,t=arguments;return new Promise((function(o,i){var a=n.apply(e,t);function c(n){r(a,o,i,c,u,"next",n)}function u(n){r(a,o,i,c,u,"throw",n)}c(void 0)}))}}var c={data:function(){return{uid:"",token:"",type:"",platform:"",contact:"",money:"",orderno:"",loading:!1,price:.01,providerList:[]}},onLoad:function(e){this.platform=n.getSystemInfoSync().platform;var t=n.getStorageSync("userInfo");""!=t&null!=t&void 0!=t&&(this.uid=t.uid,this.token=t.token),this.contact=e.contact,this.orderno=e.orderId,this.money=e.money,this.getProviders()},methods:{to:function(n){},radioChange:function(e){var t=this;if(this.type=e.detail.value,"rest"==this.type)this.restPay();else{var o,i=this.providerList.filter((function(n){return n.id==t.type}));o=i.length>0?i[0].name:"微信",n.showModal({title:"提示",content:"确认使用"+o+"支付吗",success:function(n){n.confirm&&t.weixinPay()}})}},getProviders:function(){},weixinPay:function(){var e=this;this.loading=!0;var t=this;n.login({provider:"weixin",success:function(o){console.log("login success",o),n.request({url:"https://yuying.qinshaozhuanshu.cn/app/index.php?i=2&c=entry&m=zhonghong_zhihui&do=mobile&r=api.order.pay&code=".concat(o.code,"&orderno=").concat(t.orderno,"&uid=").concat(t.uid,"&token=").concat(t.token,"&type=2"),method:"GET",success:function(o){if(console.log("pay request success",o),200===o.statusCode)if(200===o.data.state){console.log("得到接口prepay_id",o.data);var i=o.data;n.requestPayment({provider:"wxpay",timeStamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:"MD5",paySign:i.paySign,success:function(e){n.$emit("updateOrder"),setTimeout((function(){n.redirectTo({url:"./payResult?contact="+t.contact+"&money="+t.money+"&orderno="+t.orderno})}),1e3)},fail:function(e){n.showModal({content:"支付失败",showCancel:!1})},complete:function(){e.loading=!1}})}else n.showModal({content:o.data.desc,showCancel:!1});else n.showModal({content:"支付失败，请重试！",showCancel:!1})},fail:function(t){console.log("fail",t),e.loading=!1,n.showModal({content:"支付失败",showCancel:!1})}})},fail:function(t){console.log("fail",t),e.loading=!1,n.showModal({content:"支付失败",showCancel:!1})}})},requestPayment:function(e){var t=this;return a(o.default.mark((function i(){var r,a;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r=t,t.$loading(),t.loading=!0,o.next=5,t.getOrderInfo(e);case 5:a=o.sent,console.log(a),n.requestPayment({provider:e,orderInfo:a.data,success:function(e){n.hideLoading(),n.$emit("updateOrder"),setTimeout((function(){n.redirectTo({url:"./payResult?contact="+r.contact+"&money="+r.money+"&orderno="+r.orderno})}),1e3)},fail:function(e){n.showModal({content:"支付失败",showCancel:!1})},complete:function(){t.loading=!1}});case 8:case"end":return o.stop()}}),i)})))()},getOrderInfo:function(e){var t="http://yuying.qinshaozhuanshu.cn/app/index.php?i=2&c=entry&m=zhonghong_zhihui&do=mobile&r=api.member.order.payOrder",o={uid:this.uid,token:this.token,type:e,orderno:this.orderno};return new Promise((function(e){n.request({url:t,data:o,success:function(t){n.hideLoading(),e(t)},fail:function(t){n.hideLoading(),e(t)}})}))},restPay:function(){this.$loading();var e=this,t={uid:this.uid,token:this.token,orderno:this.orderno},o="&r=api.member.order.pay";this.$apiPost(o,t).then((function(t){n.hideLoading(),e.$msg("支付成功"),n.$emit("updateOrder"),setTimeout((function(){n.redirectTo({url:"./payResult?contact="+e.contact+"&money="+e.money+"&orderno="+e.orderno})}),1e3)}))}}};e.default=c}).call(this,t("543d")["default"])}},[["4e6c","common/runtime","common/vendor"]]]);