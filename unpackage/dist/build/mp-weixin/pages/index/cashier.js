(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/cashier"],{"4baf":function(e,n,t){"use strict";t.r(n);var o=t("6603"),i=t("957d");for(var r in i)"default"!==r&&function(e){t.d(n,e,(function(){return i[e]}))}(r);t("bfbe");var a,c=t("f0c5"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);n["default"]=u.exports},"4e6c":function(e,n,t){"use strict";(function(e){t("fabc");o(t("66fd"));var n=o(t("4baf"));function o(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},6603:function(e,n,t){"use strict";var o;t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return r})),t.d(n,"a",(function(){return o}));var i=function(){var e=this,n=e.$createElement;e._self._c},r=[]},"957d":function(e,n,t){"use strict";t.r(n);var o=t("fe1e"),i=t.n(o);for(var r in o)"default"!==r&&function(e){t.d(n,e,(function(){return o[e]}))}(r);n["default"]=i.a},bfbe:function(e,n,t){"use strict";var o=t("f2b3"),i=t.n(o);i.a},f2b3:function(e,n,t){},fe1e:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(t("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function r(e,n,t,o,i,r,a){try{var c=e[r](a),u=c.value}catch(s){return void t(s)}c.done?n(u):Promise.resolve(u).then(o,i)}function a(e){return function(){var n=this,t=arguments;return new Promise((function(o,i){var a=e.apply(n,t);function c(e){r(a,o,i,c,u,"next",e)}function u(e){r(a,o,i,c,u,"throw",e)}c(void 0)}))}}var c={data:function(){return{uid:"",token:"",type:"",platform:"",contact:"",money:"",orderno:"",loading:!1,price:.01,providerList:[]}},onLoad:function(n){this.platform=e.getSystemInfoSync().platform;var t=e.getStorageSync("userInfo");""!=t&null!=t&void 0!=t&&(this.uid=t.uid,this.token=t.token),this.contact=n.contact,this.orderno=n.orderId,this.money=n.money,this.getProviders()},methods:{to:function(e){},radioChange:function(n){var t=this;if(this.type=n.detail.value,console.log(this.type),"rest"==this.type)e.showModal({title:"提示",content:"确认使用余额支付吗",success:function(e){e.confirm&&t.restPay()}});else{var o,i=this.providerList.filter((function(e){return e.id==t.type}));o=i.length>0?i[0].name:"微信",e.showModal({title:"提示",content:"确认使用"+o+"支付吗",success:function(e){e.confirm&&t.weixinPay()}})}},getProviders:function(){},weixinPay:function(){var n=this;this.loading=!0;var t=this;e.login({provider:"weixin",success:function(o){console.log("login success",o),e.request({url:"https://www.wxzdhy.cn/app/index.php?i=2&c=entry&m=zhonghong_zhihui&do=mobile&r=api.order.pay&code=".concat(o.code,"&orderno=").concat(t.orderno,"&uid=").concat(t.uid,"&token=").concat(t.token,"&type=2"),method:"GET",success:function(o){if(console.log("pay request success",o),200===o.statusCode)if(200===o.data.state){console.log("得到接口prepay_id",o.data);var i=o.data;e.requestPayment({provider:"wxpay",timeStamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:"MD5",paySign:i.paySign,success:function(n){e.$emit("updateOrder"),setTimeout((function(){e.redirectTo({url:"./payResult?contact="+t.contact+"&money="+t.money+"&orderno="+t.orderno})}),1e3)},fail:function(n){e.showModal({content:"支付失败",showCancel:!1})},complete:function(){n.loading=!1}})}else e.showModal({content:o.data.desc,showCancel:!1});else e.showModal({content:"支付失败，请重试！",showCancel:!1})},fail:function(t){console.log("fail",t),n.loading=!1,e.showModal({content:"支付失败",showCancel:!1})}})},fail:function(t){console.log("fail",t),n.loading=!1,e.showModal({content:"支付失败",showCancel:!1})}})},requestPayment:function(n){var t=this;return a(o.default.mark((function i(){var r,a;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r=t,t.$loading(),t.loading=!0,o.next=5,t.getOrderInfo(n);case 5:a=o.sent,console.log(a),e.requestPayment({provider:n,orderInfo:a.data,success:function(n){e.hideLoading(),e.$emit("updateOrder"),setTimeout((function(){e.redirectTo({url:"./payResult?contact="+r.contact+"&money="+r.money+"&orderno="+r.orderno})}),1e3)},fail:function(n){e.showModal({content:"支付失败",showCancel:!1})},complete:function(){t.loading=!1}});case 8:case"end":return o.stop()}}),i)})))()},getOrderInfo:function(n){var t="http://www.wxzdhy.cn/app/index.php?i=2&c=entry&m=zhonghong_zhihui&do=mobile&r=api.member.order.payOrder",o={uid:this.uid,token:this.token,type:n,orderno:this.orderno};return new Promise((function(n){e.request({url:t,data:o,success:function(t){e.hideLoading(),n(t)},fail:function(t){e.hideLoading(),n(t)}})}))},restPay:function(){this.$loading();var n=this,t={uid:this.uid,token:this.token,orderno:this.orderno},o="&r=api.member.order.pay";this.$apiPost(o,t).then((function(t){e.hideLoading(),n.$msg("支付成功"),setTimeout((function(){e.$emit("updateOrder"),e.redirectTo({url:"./payResult?contact="+n.contact+"&money="+n.money+"&orderno="+n.orderno})}),1e3)}))}}};n.default=c}).call(this,t("543d")["default"])}},[["4e6c","common/runtime","common/vendor"]]]);