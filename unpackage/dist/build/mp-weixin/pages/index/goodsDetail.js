(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/goodsDetail"],{"166f":function(t,e,o){"use strict";var i=o("66ba"),n=o.n(i);n.a},4116:function(t,e,o){"use strict";var i={uniRate:function(){return o.e("components/uni-rate/uni-rate").then(o.bind(null,"1006"))},uniGoodsNav:function(){return o.e("components/uni-goods-nav/uni-goods-nav").then(o.bind(null,"a3c3"))}},n=function(){var t=this,e=t.$createElement;t._self._c},a=[];o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return i}))},"66ba":function(t,e,o){},"886c":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(o("4795"));function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e,o,i,n,a,s){try{var c=t[a](s),r=c.value}catch(d){return void o(d)}c.done?e(r):Promise.resolve(r).then(i,n)}function s(t){return function(){var e=this,o=arguments;return new Promise((function(i,n){var s=t.apply(e,o);function c(t){a(s,i,n,c,r,"next",t)}function r(t){a(s,i,n,c,r,"throw",t)}c(void 0)}))}}var c=function(){o.e("components/uni-rate/uni-rate").then(function(){return resolve(o("1006"))}.bind(null,o)).catch(o.oe)},r=function(){o.e("components/uni-goods-nav/uni-goods-nav").then(function(){return resolve(o("a3c3"))}.bind(null,o)).catch(o.oe)},d=function(){o.e("components/sku/pages/sku").then(function(){return resolve(o("e937"))}.bind(null,o)).catch(o.oe)},u=function(){Promise.all([o.e("common/vendor"),o.e("components/s-popup/index")]).then(function(){return resolve(o("5186"))}.bind(null,o)).catch(o.oe)},h=function(){Promise.all([o.e("common/vendor"),o.e("components/sharePrompt/sharePrompt")]).then(function(){return resolve(o("8a17"))}.bind(null,o)).catch(o.oe)},l={components:{uniRate:c,uniGoodsNav:r,sku:d,sPopup:u,sharePrompt:h},onShow:function(){},data:function(){return{merchModelStatus:!1,mpSwiperHeight:0,alterShow:!1,subNVue:"",title:"",hx_openid:"",hx_pwd:"",defaultPrice:0,videoContext:"",image:"",advImg:"",hideNav:!0,autoplay:!0,path:"",logined:!1,popshow:!1,visible:!1,visible2:!1,uid:"",token:"",id:"",merchId:"",data:"",thumb_url:"",swiperList:[],category:[],total:"",merchOption:{icon:"icon-iconfontshop-copy",text:"店铺"},receivedCategory:!1,needCategory:!1,choosedSpec:"",options:[{icon:"icon-kefu",text:"客服"},{icon:"icon-star",text:"收藏",collected:!1,color:"ff9c00"}],buttonGroup:[{text:"加入购物车",backgroundColor:"#ff0000",color:"#fff"},{text:"立即抢购",backgroundColor:"#ffa200",color:"#fff"}],collectOperate:!1}},onUnload:function(){t.$off("logined")},onLoad:function(e){var o=this;this.id=e.id;var i=t.getStorageSync("userInfo");""!=i&null!=i&void 0!=i?(this.logined=!0,this.uid=i.uid,this.token=i.token,this.hx_openid=i.hx_openid,this.hx_pwd=i.hx_pwd):this.logined=!1,this.wdnmd(),this.getDetail(),t.$on("logined",(function(){var e=t.getStorageSync("userInfo");o.logined=!0,o.uid=e.uid,o.token=e.token,this.hx_openid=i.hx_openid,this.hx_pwd=i.hx_pwd,o.getDetail()}))},onShareAppMessage:function(){return{title:this.data.title,path:"/pages/index/goodsDetail?id="+this.id,imageUrl:this.image?this.image:"/static/img/app.jpg"}},onPageScroll:function(t){0==t.scrollTop?this.hideNav=!0:this.hideNav=!1},methods:{toGoodsDetail:function(e,o){t.navigateTo({url:"goodsDetail?id="+e+"&merchId="+o})},onClick:function(t){0==t.index?this.tochat(this.data.merchid):1==t.index?this.toShop(this.data.merchid):2==t.index&&this.collect(t.content.collected)},tochat:function(e){var o=this;return s(i.default.mark((function n(){var a,s,c,r;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=o.$operateInterceptor(o.logined),a){i.next=3;break}return i.abrupt("return");case 3:s=o,o.$loading(),c={merchid:e,uid:o.uid,token:o.token},r="&r=api.member.order.contactMerch",o.$apiPost(r,c).then((function(e){o.$conn.open({apiUrl:o.$im.config.apiURL,user:s.hx_openid,pwd:s.hx_pwd,grant_type:"password",appKey:o.$im.config.appkey}),t.setStorageSync("myUsername",s.hx_openid);var i={your:e.data.merch_hx_openid,myName:s.hx_openid};t.hideLoading(),t.navigateTo({url:"/pages/chat/chat?username=".concat(JSON.stringify(i),"&title=").concat(e.data.merchname)})}));case 8:case"end":return i.stop()}}),n)})))()},buttonClick:function(t){if(console.log(t),0==t.index){if((""==this.choosedSpec.choosedid||void 0==this.choosedSpec.choosedid||null==this.choosedSpec.choosedid)&&this.needCategory)return this.collectOperate=!0,void this.chooseCategory();this.addCollect(this.choosedSpec)}else this.buy()},addCollect:function(t){var e=this.$operateInterceptor(this.logined);if(e){var o=this,i={uid:this.uid,token:this.token,goodsid:this.id,specifications:t.selectArr,skuidsort:t.choosedid.join(",")},n="&r=api.member.cart.add";this.$apiPost(n,i).then((function(t){o.collectOperate=!1,o.$msg("添加成功")}))}},buy:function(){var e=this.$operateInterceptor(this.logined);e&&(""!=this.choosedSpec.choosedid&&void 0!=this.choosedSpec.choosedid&&null!=this.choosedSpec.choosedid||!this.needCategory?null!=this.total&&0!=this.total?t.navigateTo({url:"./createOrder?goodsId="+this.id+"&merchId="+this.data.merchid+"&choosedSpec="+JSON.stringify(this.choosedSpec)+"&goodsName="+this.data.title+"&total="+this.total+"&marketprice="+this.data.marketprice}):this.$msg("该商品已卖完"):this.chooseCategory())},getCollectNum:function(){},collect:function(t){var e=this.$operateInterceptor(this.logined);if(e){var o,i=this,n={uid:this.uid,token:this.token,goodsid:this.id};o=t?"&r=api.member.favorite.remove":"&r=api.member.favorite.add",this.$apiPost(o,n).then((function(e){t?(i.options[2].collected=!1,i.options[2].icon="icon-star"):(i.options[2].collected=!0,i.options[2].icon="icon-shoucang")}))}},focus:function(e){var o=this,i=this.$operateInterceptor(this.logined);if(i){if(this.$loading(),"1"==this.data.isCollect)var n="&r=api.member.collection.remove";else n="&r=api.member.collection.add";var a=this,s={uid:this.uid,token:this.token,merchid:e};this.$apiPost(n,s).then((function(e){t.hideLoading(),"1"==o.data.isCollect?(a.$msg("取消关注"),a.data.isCollect="0"):(a.$msg("已关注"),a.data.isCollect="1")}))}},chooseCategory:function(){if(this.needCategory){var e=this;t.$on("closeSku",(function(){e.subNVue.show(),e.alterShow=!1})),this.defaultPrice=this.data.marketprice.split(" - ")[0],this.$refs.sku.specClass="show"}},openShare:function(){var t=this.$operateInterceptor(this.logined);t&&(this.title=this.data.title,this.popshow=!0)},getDetail:function(){var e=this,o="&r=api.goods.detail&id="+this.id+"&uid="+this.uid+"&token="+this.token;this.$apiPost(o).then((function(o){e.data=o.data,e.getCategory(),t.setNavigationBarTitle({title:o.data.title});var i=e.data.marketprice.split(" - ");i.length>1&&i[0]==i[1]&&(e.data.marketprice=i[0]),e.thumb_url=o.data.thumb_url,"1"==e.data.isFavorite?(e.options[2].collected=!0,e.options[2].icon="icon-shoucang"):(e.options[2].collected=!1,e.options[2].icon="icon-star"),e.$nextTick((function(){e.videoContext=t.createVideoContext("myVideo"),setTimeout((function(){t.getSystemInfo({success:function(o){var i=t.createSelectorQuery().select("#mpSwiper");i.boundingClientRect((function(t){console.log(t),e.mpSwiperHeight=t.width})).exec()}})}),0)}))}))},getCategory:function(){var t=this,e="&r=api.goods.detail.sku&goodsid="+this.id;this.$apiPost(e).then((function(e){t.category=e.data,t.total=e.stock,"暂无数据"==e.resultMessage?t.needCategory=!1:t.needCategory=!0,t.$nextTick((function(){t.receivedCategory=!0}))}))},pause:function(){this.autoplay=!0},play:function(){this.autoplay=!1},swiperChange:function(t){this.autoplay=!0,this.videoContext.pause()},completeSpecChoose:function(e){this.collectOperate?this.addCollect(e):(this.choosedSpec=e,t.navigateTo({url:"./createOrder?goodsId="+this.id+"&merchId="+this.data.merchid+"&choosedSpec="+JSON.stringify(this.choosedSpec)+"&goodsName="+this.data.title+"&total="+this.total+"&marketprice="+this.data.marketprice}))},toComments:function(){this.data.comments&&t.navigateTo({url:"./goodsComments?id="+this.id})},toShop:function(e){t.navigateTo({url:"/pages/bussiness/shopPreview?id=".concat(e)})},closeSharePrompt:function(){this.popshow=!1},readImg:function(e){t.previewImage({current:e,urls:[e]})},closesku:function(){console.log("close"),this.subNVue.show(),this.alterShow=!1},getPoster:function(t){this.visible=!0,this.advImg=t},saveImg:function(e){var o=this;o.$loading(),t.downloadFile({url:e,success:function(e){200===e.statusCode&&t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){t.hideLoading(),o.$msg("保存成功，请到相册中查看"),o.visible=!1},fail:function(){t.hideLoading(),o.$msg("保存失败")},complete:function(){}})}})},hide:function(){},wdnmd:function(){var t=this,e=this,o="&r=api.mo";this.$apiPost(o).then((function(t){e.merchModelStatus=Number(t.data.status),1==e.merchModelStatus&&e.options.splice(1,0,e.merchOption)})).catch((function(e){t.$msg(e)}))}}};e.default=l}).call(this,o("543d")["default"])},a86b:function(t,e,o){"use strict";o.r(e);var i=o("4116"),n=o("e42b");for(var a in n)"default"!==a&&function(t){o.d(e,t,(function(){return n[t]}))}(a);o("166f");var s,c=o("f0c5"),r=Object(c["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=r.exports},dbb9:function(t,e,o){"use strict";(function(t){o("fabc");i(o("66fd"));var e=i(o("a86b"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},e42b:function(t,e,o){"use strict";o.r(e);var i=o("886c"),n=o.n(i);for(var a in i)"default"!==a&&function(t){o.d(e,t,(function(){return i[t]}))}(a);e["default"]=n.a}},[["dbb9","common/runtime","common/vendor"]]]);