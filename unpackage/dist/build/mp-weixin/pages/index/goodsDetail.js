(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/goodsDetail"],{"166f":function(t,e,o){"use strict";var n=o("66ba"),i=o.n(n);i.a},"66ba":function(t,e,o){},"886c":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(o("4795"));function i(t){return t&&t.__esModule?t:{default:t}}function s(t,e,o,n,i,s,a){try{var c=t[s](a),r=c.value}catch(u){return void o(u)}c.done?e(r):Promise.resolve(r).then(n,i)}function a(t){return function(){var e=this,o=arguments;return new Promise((function(n,i){var a=t.apply(e,o);function c(t){s(a,n,i,c,r,"next",t)}function r(t){s(a,n,i,c,r,"throw",t)}c(void 0)}))}}var c=function(){o.e("components/uni-rate/uni-rate").then(function(){return resolve(o("1006"))}.bind(null,o)).catch(o.oe)},r=function(){o.e("components/uni-goods-nav/uni-goods-nav").then(function(){return resolve(o("a3c3"))}.bind(null,o)).catch(o.oe)},u=function(){o.e("components/sku/pages/sku").then(function(){return resolve(o("e937"))}.bind(null,o)).catch(o.oe)},d=function(){Promise.all([o.e("common/vendor"),o.e("components/s-popup/index")]).then(function(){return resolve(o("5186"))}.bind(null,o)).catch(o.oe)},l={components:{uniRate:c,uniGoodsNav:r,sku:u,sPopup:d},onShow:function(){},data:function(){return{image:"",advImg:"",hideNav:!0,path:"",logined:!1,popshow:!1,visible:!1,uid:"",token:"",id:"",merchId:"",data:"",thumb_url:"",category:[],total:"",receivedCategory:!1,needCategory:!1,choosedSpec:"",options:[{icon:"icon-kefu",text:"客服"},{icon:"icon-iconfontshop-copy",text:"店铺"},{icon:"icon-star",text:"收藏",collected:!1,color:"ff9c00"}],buttonGroup:[{text:"加入购物车",backgroundColor:"#ff0000",color:"#fff"},{text:"立即抢购",backgroundColor:"#ffa200",color:"#fff"}],providerList:[],shareType:0,shareText:"嘎哈"}},onLoad:function(e){var o=this;this.id=e.id;var n=t.getStorageSync("userInfo");""!=n&null!=n&void 0!=n?(this.logined=!0,this.uid=n.uid,this.token=n.token):this.logined=!1,this.getDetail(),this.getProvider(),t.$on("logined",(function(){var e=t.getStorageSync("userInfo");o.logined=!0,o.uid=e.uid,o.token=e.token,o.getDetail()}))},onShareAppMessage:function(){return{title:"小美女小帅哥快来买啊",path:"/pages/index/goodsDetail?id="+this.id,imageUrl:this.image?this.image:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/app/share-logo@3.png"}},onPageScroll:function(t){0==t.scrollTop?this.hideNav=!0:this.hideNav=!1},methods:{toGoodsDetail:function(e,o){t.navigateTo({url:"goodsDetail?id="+e+"&merchId="+o})},onClick:function(t){0==t.index||(1==t.index?this.toShop(this.data.merchid):2==t.index&&this.collect(t.content.collected))},buttonClick:function(t){console.log(t),0==t.index?this.addCollect():this.buy()},addCollect:function(){var t=this.$operateInterceptor(this.logined);if(t){var e=this,o={uid:this.uid,token:this.token,goodsid:this.id},n="&r=api.member.cart.add";this.$apiPost(n,o).then((function(t){e.$msg("添加成功")}))}},buy:function(){var e=this.$operateInterceptor(this.logined);e&&((""==this.choosedSpec.choosedid||void 0==this.choosedSpec.choosedid||null==this.choosedSpec.choosedid)&this.needCategory?this.chooseCategory():null!=this.total&&0!=this.total?t.navigateTo({url:"./createOrder?goodsId="+this.id+"&merchId="+this.data.merchid+"&choosedSpec="+JSON.stringify(this.choosedSpec)+"&goodsName="+this.data.title+"&total="+this.total+"&marketprice="+this.data.marketprice}):this.$msg("该商品已卖完"))},getCollectNum:function(){},collect:function(t){var e=this.$operateInterceptor(this.logined);if(e){var o,n=this,i={uid:this.uid,token:this.token,goodsid:this.id};o=t?"&r=api.member.favorite.remove":"&r=api.member.favorite.add",this.$apiPost(o,i).then((function(e){t?(n.options[2].collected=!1,n.options[2].icon="icon-star"):(n.options[2].collected=!0,n.options[2].icon="icon-shoucang")}))}},focus:function(t){var e=this.$operateInterceptor(this.logined);if(e&&"1"!=this.data.isCollect){var o=this,n={uid:this.uid,token:this.token,merchid:t},i="&r=api.member.collection.add";this.$apiPost(i,n).then((function(t){o.data.isCollect="1",o.$msg("已关注")}))}},chooseCategory:function(){this.needCategory&&(this.$refs.sku.specClass="show")},openShare:function(){this.popshow=!0},getDetail:function(){var t=this,e="&r=api.goods.detail&id="+this.id+"&uid="+this.uid+"&token="+this.token;this.$apiPost(e).then((function(e){t.data=e.data,t.thumb_url=e.data.thumb_url,"1"==t.data.isFavorite?(t.options[2].collected=!0,t.options[2].icon="icon-shoucang"):(t.options[2].collected=!1,t.options[2].icon="icon-star"),t.$nextTick((function(){t.getCategory()}))}))},getCategory:function(){var t=this,e="&r=api.goods.detail.sku&goodsid="+this.id;this.$apiPost(e).then((function(e){t.category=e.data,t.total=e.stock,"暂无数据"==e.resultMessage?t.needCategory=!1:t.needCategory=!0,t.$nextTick((function(){t.receivedCategory=!0}))}))},completeSpecChoose:function(t){this.choosedSpec=t},toComments:function(){t.navigateTo({url:"./goodsComments?id="+this.id})},toShop:function(e){t.navigateTo({url:"/pages/bussiness/shopPreview?id=".concat(e)})},createPoster:function(){var e=this.$operateInterceptor(this.logined);if(e){this.$loading();var o=this,n={uid:this.uid,token:this.token,goodsid:this.id},i="&r=api.common.share.createPoster";this.$apiPost(i,n).then((function(e){o.advImg=e.data.img,o.visible=!0,o.popshow=!1,t.hideLoading()}))}},saveImg:function(e){var o=this;o.$loading(),t.downloadFile({url:e,success:function(e){200===e.statusCode&&t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){o.$msg("保存成功，请到相册中查看"),o.visible=!1},fail:function(){o.$msg("保存失败")},complete:function(){t.hideLoading()}})}})},getProvider:function(){var e=this;t.getProvider({service:"share",success:function(t){console.log("success",t);for(var o=[],n=0;n<t.provider.length;n++)switch(t.provider[n]){case"weixin":o.push({name:"微信",id:"weixin",sort:0}),o.push({name:"朋友圈",id:"weixin",type:"WXSenceTimeline",sort:1});break;default:break}e.providerList=o.sort((function(t,e){return t.sort-e.sort}))},fail:function(e){console.log("获取分享通道失败",e),t.showModal({content:"获取分享通道失败",showCancel:!1})}})},share:function(e){var o=this;return a(n.default.mark((function i(){var s;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log(e),console.log("分享通道:"+e.id+"； 分享类型:"+o.shareType),s={provider:e.id,extra:{scene:"WXSceneSession"},scene:e.type&&"WXSenceTimeline"===e.type?"WXSenceTimeline":"WXSceneSession",type:o.shareType,success:function(e){console.log("success",e),t.showModal({content:"已分享",showCancel:!1})},fail:function(e){console.log("fail",e),t.showModal({content:e.errMsg,showCancel:!1})},complete:function(){console.log("分享操作结束!")}},n.t0=o.shareType,n.next=0===n.t0?6:1===n.t0?11:2===n.t0?13:5===n.t0?15:19;break;case 6:return s.summary="好玩",s.imageUrl="https://img-cdn-qiniu.dcloud.net.cn/uniapp/app/share-logo@3.png",s.title=o.data.title,s.href="https://uniapp.dcloud.io",n.abrupt("break",20);case 11:return s.summary=o.shareText,n.abrupt("break",20);case 13:return s.imageUrl=o.image,n.abrupt("break",20);case 15:return s.imageUrl=o.image?o.image:"https://img-cdn-qiniu.dcloud.net.cn/uniapp/app/share-logo@3.png",s.title=o.data.title+"买啊",s.miniProgram={id:"gh_33446d7f7a26",path:"/pages/tabBar/component/component",webUrl:"https://uniapp.dcloud.io",type:0},n.abrupt("break",20);case 19:return n.abrupt("break",20);case 20:if(0!==s.type||"iOS"!==plus.os.name){n.next=24;break}return n.next=23,o.compress();case 23:s.imageUrl=n.sent;case 24:1===s.type&&"qq"===s.provider&&(s.href="https://uniapp.dcloud.io",s.title="欢迎体验uniapp"),t.share(s);case 26:case"end":return n.stop()}}),i)})))()}}};e.default=l}).call(this,o("543d")["default"])},a86b:function(t,e,o){"use strict";o.r(e);var n=o("c4f0"),i=o("e42b");for(var s in i)"default"!==s&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("166f");var a,c=o("f0c5"),r=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);e["default"]=r.exports},c4f0:function(t,e,o){"use strict";var n={uniRate:function(){return o.e("components/uni-rate/uni-rate").then(o.bind(null,"1006"))},uniGoodsNav:function(){return o.e("components/uni-goods-nav/uni-goods-nav").then(o.bind(null,"a3c3"))}},i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.popshow=!1},t.e1=function(e){t.popshow=!1})},s=[];o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}))},dbb9:function(t,e,o){"use strict";(function(t){o("fabc");n(o("66fd"));var e=n(o("a86b"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},e42b:function(t,e,o){"use strict";o.r(e);var n=o("886c"),i=o.n(n);for(var s in n)"default"!==s&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a}},[["dbb9","common/runtime","common/vendor"]]]);